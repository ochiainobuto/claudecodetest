<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SakegeChan - ãƒ‰ãƒ³ã‚­ãƒ¼ã‚³ãƒ³ã‚°é¢¨ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #game-canvas {
            border: 2px solid #fff;
            background: #1a1a2e;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        #instructions {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.5);
            text-align: center;
            z-index: 1000;
        }

        #instructions h2 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 20px;
        }

        #instructions p {
            margin: 5px 0;
            color: #666;
            font-size: 14px;
        }

        .key {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin: 0 2px;
        }
    </style>
</head>
<body>
    <div id="instructions">
        <h2>ğŸ® ãƒ‰ãƒ³ã‚­ãƒ¼ã‚³ãƒ³ã‚°é¢¨ã‚²ãƒ¼ãƒ </h2>
        <p>
            <span class="key">â†</span>
            <span class="key">â†’</span>
            ç§»å‹• |
            <span class="key">ã‚¹ãƒšãƒ¼ã‚¹</span>
            ã‚¸ãƒ£ãƒ³ãƒ—
        </p>
    </div>

    <canvas id="game-canvas"></canvas>

    <script>
        // Canvasè¨­å®š
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = 800;
        canvas.height = 600;

        // ç”»åƒã®èª­ã¿è¾¼ã¿
        const playerImg = new Image();
        playerImg.src = 'images/sakegechan_stand.png';

        const blockImg = new Image();
        blockImg.src = 'images/block01.png';

        // ã‚²ãƒ¼ãƒ å®šæ•°
        const GRAVITY = 0.6;
        const JUMP_STRENGTH = -15;
        const MOVE_SPEED = 5;
        const BLOCK_SIZE = 40;

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
        const player = {
            x: 100,
            y: 100,
            width: 50,
            height: 50,
            velocityX: 0,
            velocityY: 0,
            isOnGround: false,
            isJumping: false
        };

        // ãƒ‰ãƒ³ã‚­ãƒ¼ã‚³ãƒ³ã‚°é¢¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
        // å„ãƒ–ãƒ­ãƒƒã‚¯ã¯ [x, y, width, height] ã®å½¢å¼ï¼ˆãƒ–ãƒ­ãƒƒã‚¯å˜ä½ï¼‰
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é«˜ã•(50px)ã‚ˆã‚Šå¤§ãã„éš™é–“(80px)ã‚’ç¢ºä¿
        const platforms = [
            // åº•é¢
            { x: 0, y: 560, width: 800, height: 40 },

            // 1éšå±¤ç›®ï¼ˆå³å´ï¼‰
            { x: 500, y: 440, width: 300, height: 40 },

            // 2éšå±¤ç›®ï¼ˆå·¦å´ï¼‰
            { x: 0, y: 320, width: 350, height: 40 },

            // 3éšå±¤ç›®ï¼ˆå³å´ï¼‰
            { x: 450, y: 200, width: 350, height: 40 },

            // 4éšå±¤ç›®ï¼ˆå·¦å´ï¼‰- ã‚´ãƒ¼ãƒ«åœ°ç‚¹
            { x: 0, y: 80, width: 400, height: 40 }
        ];

        // ã‚­ãƒ¼å…¥åŠ›
        const keys = {};

        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;

            // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ã‚¸ãƒ£ãƒ³ãƒ—
            if ((e.key === ' ' || e.key === 'ArrowUp') && player.isOnGround) {
                player.velocityY = JUMP_STRENGTH;
                player.isOnGround = false;
                player.isJumping = true;
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // è¡çªåˆ¤å®š
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ›´æ–°
        function updatePlayer() {
            // æ°´å¹³ç§»å‹•
            if (keys['ArrowLeft'] || keys['a']) {
                player.velocityX = -MOVE_SPEED;
            } else if (keys['ArrowRight'] || keys['d']) {
                player.velocityX = MOVE_SPEED;
            } else {
                player.velocityX = 0;
            }

            // é‡åŠ›é©ç”¨
            player.velocityY += GRAVITY;

            // ä½ç½®æ›´æ–°
            player.x += player.velocityX;
            player.y += player.velocityY;

            // åœ°é¢åˆ¤å®šãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
            player.isOnGround = false;

            // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ã®è¡çªåˆ¤å®š
            platforms.forEach(platform => {
                if (checkCollision(player, platform)) {
                    // ä¸Šã‹ã‚‰è½ã¡ã¦ããŸå ´åˆ
                    if (player.velocityY > 0 && player.y + player.height - player.velocityY <= platform.y + 5) {
                        player.y = platform.y - player.height;
                        player.velocityY = 0;
                        player.isOnGround = true;
                        player.isJumping = false;
                    }
                    // ä¸‹ã‹ã‚‰å½“ãŸã£ãŸå ´åˆ
                    else if (player.velocityY < 0 && player.y - player.velocityY >= platform.y + platform.height - 5) {
                        player.y = platform.y + platform.height;
                        player.velocityY = 0;
                    }
                    // æ¨ªã‹ã‚‰å½“ãŸã£ãŸå ´åˆ
                    else if (player.velocityX > 0) {
                        player.x = platform.x - player.width;
                    } else if (player.velocityX < 0) {
                        player.x = platform.x + platform.width;
                    }
                }
            });

            // ç”»é¢ç«¯ã®åˆ¶é™
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) {
                player.x = canvas.width - player.width;
            }

            // ç”»é¢ä¸‹ã«è½ã¡ãŸã‚‰ãƒªã‚»ãƒƒãƒˆ
            if (player.y > canvas.height) {
                player.x = 100;
                player.y = 100;
                player.velocityX = 0;
                player.velocityY = 0;
            }
        }

        // æç”»
        function draw() {
            // èƒŒæ™¯ã‚’ã‚¯ãƒªã‚¢
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’æç”»
            platforms.forEach(platform => {
                // ãƒ–ãƒ­ãƒƒã‚¯ç”»åƒã§ã‚¿ã‚¤ãƒ«çŠ¶ã«æç”»
                const blocksX = Math.ceil(platform.width / BLOCK_SIZE);
                const blocksY = Math.ceil(platform.height / BLOCK_SIZE);

                for (let i = 0; i < blocksX; i++) {
                    for (let j = 0; j < blocksY; j++) {
                        const drawX = platform.x + i * BLOCK_SIZE;
                        const drawY = platform.y + j * BLOCK_SIZE;
                        const drawWidth = Math.min(BLOCK_SIZE, platform.width - i * BLOCK_SIZE);
                        const drawHeight = Math.min(BLOCK_SIZE, platform.height - j * BLOCK_SIZE);

                        if (blockImg.complete) {
                            ctx.drawImage(blockImg, drawX, drawY, drawWidth, drawHeight);
                        } else {
                            // ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã®ä»£æ›¿è¡¨ç¤º
                            ctx.fillStyle = '#8B4513';
                            ctx.fillRect(drawX, drawY, drawWidth, drawHeight);
                            ctx.strokeStyle = '#654321';
                            ctx.strokeRect(drawX, drawY, drawWidth, drawHeight);
                        }
                    }
                }
            });

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æç”»
            if (playerImg.complete) {
                ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
            } else {
                // ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã®ä»£æ›¿è¡¨ç¤º
                ctx.fillStyle = '#ff6b6b';
                ctx.fillRect(player.x, player.y, player.width, player.height);
            }

            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±
            ctx.fillStyle = '#fff';
            ctx.font = '14px Arial';
            ctx.fillText(`ä½ç½®: (${Math.floor(player.x)}, ${Math.floor(player.y)})`, 10, 20);
            ctx.fillText(`é€Ÿåº¦: (${Math.floor(player.velocityX)}, ${Math.floor(player.velocityY)})`, 10, 40);
            ctx.fillText(`åœ°é¢: ${player.isOnGround ? 'ã¯ã„' : 'ã„ã„ãˆ'}`, 10, 60);
        }

        // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
        function gameLoop() {
            updatePlayer();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ã‚²ãƒ¼ãƒ é–‹å§‹
        let imagesLoaded = 0;
        const totalImages = 2;

        function checkImagesLoaded() {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                gameLoop();
            }
        }

        playerImg.onload = checkImagesLoaded;
        blockImg.onload = checkImagesLoaded;

        // ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹
        playerImg.onerror = checkImagesLoaded;
        blockImg.onerror = checkImagesLoaded;
    </script>
</body>
</html>
